# Изменения в проекте data-processor-service

## Что было удалено:
1. **Метрики и мониторинг**: Удален модуль `metrics.rs` и все связанные зависимости (OpenTelemetry, Prometheus, HTTP сервер)
2. **HTTP сервер**: Убран warp сервер для health checks и метрик
3. **Сложная конфигурация**: Упрощена структура конфигурации, убраны настройки метрик

## Что было изменено:

### 1. Модели данных
- Заменены старые модели `MeterData` и `MeterDataInput` на новые:
  - `SensorData` - для входящих данных из RabbitMQ
  - `SensorReading` и `SensorReadingInput` - для хранения в базе данных
  - Добавлены специфичные структуры для разных типов данных:
    - `EnergyPayload` - для данных об энергии
    - `AirQualityPayload` - для данных о качестве воздуха
    - `MotionPayload` - для данных о движении

### 2. Схема базы данных
- Таблица `meter_data` заменена на `sensor_readings`
- Поле `payload` теперь имеет тип `JSONB` для хранения различных типов данных
- Добавлены индексы для эффективных запросов по типу сенсора и имени

### 3. RabbitMQ обработчик
- Обновлен для работы с новым форматом JSON данных
- Теперь ожидает массив объектов с полями `type`, `name`, `payload`
- Исправлены проблемы совместимости с новой версией lapin

### 4. Процессор данных
- Адаптирован под новые модели данных
- Упрощен - убрана логика метрик
- Сохраняет данные в новом формате в PostgreSQL

### 5. Конфигурация
- Упрощена структура конфигурации
- Убраны настройки метрик и HTTP сервера
- Оставлены только настройки RabbitMQ, базы данных и обработки

### 6. Docker
- Обновлен Dockerfile - убраны ссылки на метрики и health checks
- Упрощен образ - убраны ненужные зависимости

## Новый формат данных

Проект теперь ожидает данные в следующем формате:

```json
[
    {
        "type": "energy",
        "name": "Office",
        "payload": {
            "energy": 770.79
        }
    },
    {
        "type": "air_quality",
        "name": "Living Room",
        "payload": {
            "co2": 864,
            "pm25": 7,
            "humidity": 72
        }
    },
    {
        "type": "motion",
        "name": "Kitchen",
        "payload": {
            "motionDetected": true
        }
    }
]
```

## Результат

Проект теперь представляет собой простой сервис, который:
1. Подключается к RabbitMQ
2. Получает данные в новом формате
3. Сохраняет их в PostgreSQL
4. Не имеет внешних зависимостей кроме RabbitMQ и PostgreSQL

Все метрики, мониторинг и HTTP endpoints удалены для упрощения архитектуры.
